<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HSG R√º/Bau/K√∂ ‚Äì Digitales Playbook</title>
  <style>
    :root {
      --brand: #ff00a0;
      --brand-dark: #cc0080;
      --bg: #f7f7f8;
      --card: #fff;
      --muted: #666;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      margin: 0;
      color: #111;
    }
    header {
      background: var(--brand);
      color: #fff;
      padding: 0.9rem 1rem;
      text-align: center;
    }
    header h1 { margin: 0; font-size: 1.1rem; font-weight: 700; }
    main { max-width: 1000px; margin: 1rem auto; padding: 0 1rem; }

    .hidden { display: none !important; }

    /* Playbook Grid */
    .plays { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
    .play {
      background: var(--card);
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      padding: 0.8rem;
    }
    .play h3 { margin: 0.4rem 0; color: var(--brand-dark); }
    .play p { color: var(--muted); font-size: 0.9rem; }
    .play video, .play iframe {
      width: 100%;
      border-radius: 8px;
      margin-top: 0.4rem;
      background: #000;
      aspect-ratio: 16 / 9;
    }
    button, select, input, textarea { font-family: inherit; }
    button {
      background: var(--brand);
      color: #fff;
      border: 0;
      border-radius: 6px;
      padding: 0.45rem 0.7rem;
      cursor: pointer;
    }
    button:hover { background: var(--brand-dark); }

    /* Admin area */
    .admin-panel {
      background: var(--card);
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      margin-bottom: 1rem;
    }
    .admin-panel h2 { margin-top:0;color:var(--brand-dark);}
    .admin-panel label { display:block;font-weight:600;margin-top:0.5rem; }
    .admin-panel input, .admin-panel textarea, .admin-panel select {
      width:100%; padding:0.45rem; border-radius:6px; border:1px solid #ddd; margin-top:0.25rem;
    }
    .play-actions { margin-top:0.5rem; display:flex; justify-content:space-between; gap:0.5rem; }

    /* Login Screen */
    .login-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: var(--bg);
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
    .login-screen input {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 220px;
      text-align: center;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login-screen">
  <h2>üîí HSG Playbook Login</h2>
  <input type="password" id="pw" placeholder="Passwort eingeben">
  <button onclick="login()">Login</button>
  <p style="font-size:0.9rem;color:var(--muted)">Nur f√ºr Teammitglieder und Coaches</p>
</div>

<!-- CONTENT -->
<div id="content" class="hidden">
  <header>
    <h1>üèê HSG R√º/Bau/K√∂ ‚Äì Digitales Playbook</h1>
  </header>
  <main>
    <!-- Admin -->
    <section id="admin-section" class="admin-panel hidden">
      <h2>Coach Verwaltungsbereich</h2>
      <form id="addPlayForm" onsubmit="addPlay(event)">
        <label>Titel des Spielzugs</label>
        <input id="play-title" required>
        <label>Beschreibung</label>
        <textarea id="play-desc" rows="2" required></textarea>
        <label>Kategorie</label>
        <select id="play-cat">
          <option>Angriff</option>
          <option>Abwehr</option>
          <option>Standard</option>
        </select>
        <label>Videoquelle</label>
        <select id="play-srcType">
          <option value="youtube">YouTube-Link</option>
          <option value="mp4">MP4-Datei</option>
        </select>
        <input id="play-src" placeholder="YouTube-URL oder Pfad zur MP4">
        <button type="submit">‚ûï Spielzug speichern</button>
      </form>
    </section>

    <!-- √úbersicht -->
    <section>
      <h2>üìñ Spielz√ºge</h2>
      <div id="plays" class="plays"></div>
    </section>
  </main>
</div>

<script>
const PLAYER_PW = "hsg2025!";
const ADMIN_PW = "coach2025!";
let isAdmin = false;
let plays = [];

async function login(){
  const input = document.getElementById("pw").value.trim();
  if(input === PLAYER_PW){ isAdmin = false; startApp(); }
  else if(input === ADMIN_PW){ isAdmin = true; startApp(); }
  else return alert("Falsches Passwort!");
}

function startApp(){
  document.getElementById("login").classList.add("hidden");
  document.getElementById("content").classList.remove("hidden");
  if(isAdmin) document.getElementById("admin-section").classList.remove("hidden");
  loadPlays();
}

/* API-Aufrufe */
async function loadPlays(){
  try {
    const res = await fetch('/api/plays');
    plays = await res.json();
    renderPlays();
  } catch(err){ console.error(err); alert("Fehler beim Laden der Spielz√ºge"); }
}

async function addPlay(e){
  e.preventDefault();
  const title = document.getElementById("play-title").value.trim();
  const desc = document.getElementById("play-desc").value.trim();
  const cat = document.getElementById("play-cat").value;
  const srcType = document.getElementById("play-srcType").value;
  const src = document.getElementById("play-src").value.trim();

  if(!title || !src) return alert("Bitte Titel und Videoquelle angeben!");

  try {
    const res = await fetch('/api/plays', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ password: ADMIN_PW, title, desc, cat, srcType, src })
    });
    const data = await res.json();
    if(data.success){
      e.target.reset();
      loadPlays();
    } else alert(data.error || 'Fehler beim Speichern');
  } catch(err){ console.error(err); alert('Fehler beim Speichern'); }
}

async function deletePlay(idx){
  if(!confirm("Diesen Spielzug wirklich l√∂schen?")) return;
  try {
    const res = await fetch(`/api/plays/${idx}`, {
      method:'DELETE',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ password: ADMIN_PW })
    });
    const data = await res.json();
    if(data.success) loadPlays();
    else alert(data.error || 'Fehler beim L√∂schen');
  } catch(err){ console.error(err); alert('Fehler beim L√∂schen'); }
}

function renderPlays(){
  const container = document.getElementById("plays");
  container.innerHTML = "";
  if(plays.length===0){ container.innerHTML="<p style='color:var(--muted)'>Noch keine Spielz√ºge vorhanden.</p>"; return; }
  plays.forEach((p,idx)=>{
    const div=document.createElement("div");
    div.className="play";
    div.innerHTML=`
      <h3>${p.title}</h3>
      <p><strong>Kategorie:</strong> ${p.cat}</p>
      <p>${p.desc}</p>
      ${p.srcType==='youtube'
        ? `<iframe src="${convertToEmbed(p.src)}" allowfullscreen></iframe>`
        : `<video controls src="${p.src}"></video>`}
      ${isAdmin?`<div class="play-actions"><button onclick="deletePlay(${idx})">üóëÔ∏è L√∂schen</button></div>`:""}
    `;
    container.appendChild(div);
  });
}

function convertToEmbed(url){
  if(!url.includes("youtube")) return url;
  const id = url.split("v=")[1]?.split("&")[0];
  return `https://www.youtube.com/embed/${id}`;
}
</script>
</body>
</html>
